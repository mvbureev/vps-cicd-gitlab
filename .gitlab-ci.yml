image: docker:latest
services:
  - docker:dind

stages:
  - deploy

deploy:
  stage: deploy
  script:
    - apk update && apk add docker-compose
    - rm -rf ./frontend/.next
    - docker image prune -f
    - docker-compose -f docker-compose.yaml build --no-cache
    # - docker-compose -f docker-compose.yaml stop
    # - docker-compose -f docker-compose.yaml down --rmi all --volumes
    - docker-compose -f docker-compose.yaml up -d
  only:
    - master
