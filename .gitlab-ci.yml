image: docker:20-dind
services:
- name: docker:20-dind
  alias: docker
  command: ["--tls=false"]

variables:
  DOCKER_DRIVER: overlay
  DOCKER_HOST: tcp://docker:2375 
  DOCKER_TLS_CERTDIR: ""
  IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG
  FF_GITLAB_REGISTRY_HELPER_IMAGE: 1

stages:
  - deploy

deploy:
  stage: deploy
  script:
    - apk add docker-compose
    - docker-compose -f docker-compose.yaml down
    - docker-compose -f docker-compose.yaml up --build
  only:
    - master
